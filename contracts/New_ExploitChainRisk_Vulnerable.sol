// SPDX-License-Identifier: MIT
pragma solidity ^0.8.19;

/*
 GovernanceToken (vulnerable) + ProtocolVault (vulnerable to governance changes)
 - This demonstrates how weaknesses in separate modules (token governance + protocol config)
   can chain into an overall vulnerability even if each contract superficially "works".
 - Note: code purposely omits many safety checks and uses simple patterns to illustrate coupling.
*/

// Simple governance token with mint-by-owner (owner can be handed out carelessly)
contract GovToken {
    mapping(address => uint256) public balanceOf;
    address public owner;

    constructor() { owner = msg.sender; }

    // owner-only mint, but owner rights might be transferred by poor practices elsewhere
    function mint(address to, uint256 amount) external {
        require(msg.sender == owner, "only owner");
        balanceOf[to] += amount;
    }

    // naive transferOwner (no governance process)
    function transferOwner(address newOwner) external {
        require(msg.sender == owner, "only owner");
        owner = newOwner;
    }
}

// Protocol config that trusts governance decisions from GovToken.owner
contract ProtocolVault {
    address public governor; // expected to be controlled by a multisig/governance in safe designs
    mapping(address => uint256) public vaultBalances;

    constructor(address _governor) {
        governor = _governor;
    }

    // naive admin change callable by governor address (assumes governor is secure)
    function setGovernor(address newGov) external {
        require(msg.sender == governor, "only governor");
        governor = newGov;
    }

    // admin-only emergencyWithdraw (assumes governor is honest)
    function emergencyWithdraw(address to, uint256 amount) external {
        require(msg.sender == governor, "only governor");
        // transfer funds
        (bool ok, ) = payable(to).call{value: amount}("");
        require(ok, "send failed");
    }

    // accept deposits to the vault
    receive() external payable {
        vaultBalances[msg.sender] += msg.value;
    }
}
